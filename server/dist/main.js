(()=>{"use strict";var e,r,o,t,s,a,n,i={831:(e,r,o)=>{o.d(r,{U:()=>u,a:()=>i});var t=o(913),s=o(185);(async()=>{await(0,s.connect)(t.Z.mongodb.path)})().catch((e=>{throw console.log(e),new Error("error con mongoose")}));const a=new s.Schema({author:{id:{type:String,required:!0},firstName:{type:String,required:!0,max:50},lastName:{type:String,required:!0,max:50},age:{type:Number,required:!0},alias:{type:String,required:!0,max:20},avatar:{type:String,required:!0}},text:{type:String,required:!0,max:500}}),n=(0,s.model)("messages",a),i=async e=>{const r=new n(e);try{r.save()}catch(e){throw console.log(e),new Error("Error")}},u=async()=>{try{return await n.find()}catch(e){throw console.log(e),new Error("Error")}}},983:(e,r,o)=>{o.a(e,(async(e,t)=>{try{let e,s;o.d(r,{F:()=>s,p:()=>e}),o(81);const{default:a}=await o.e(516).then(o.bind(o,516)),{default:n}=await o.e(917).then(o.bind(o,917));s=new a,e=new n,t()}catch(e){t(e)}}),1)},913:(e,r,o)=>{o.d(r,{Z:()=>t});const t={fileSystem:{path:"./controllers"},mongodb:{path:"mongodb+srv://julian:yYh1YRWZiJ0EcbHi@cluster0.ovaqa.mongodb.net/myFirstDatabase?retryWrites=true"}}},695:(e,r,o)=>{o.a(e,(async(e,t)=>{try{o.d(r,{W:()=>d,t:()=>l});var s=o(860),a=o(986),n=o.n(a),i=o(983),u=e([i]);i=(u.then?(await u)():u)[0];const c=!0,d=(0,s.Router)();d.use(n().json()),d.route("/api/productos/:id?").get((async(e,r,o)=>{let t;if(t=e.body.id?Number(e.body.id):Number(e.params.id),t){const e=await i.p.getById(t);e?r.status(200).json(e):r.status(404).json({error:" Error with ID "})}else{const e=await i.p.getAll();e?r.status(200).json(e):r.status(404)}})).post((async(e,r)=>{if(c)if(e.params.id)r.status(400).json({error:" No se puede crear un producto con un id"});else{const o=e.body,t=i.p.save(o);r.status(200).json(`El producto ${e.body.nombre} con el id ${t} se generó correctamente`)}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})})).put((async(e,r)=>{if(c){const o=e.body;let t;t=e.body.id?Number(e.body.id):Number(e.params.id),i.p.modifyById(o,t).then((e=>e?r.status(202).json("Producto modificado"):r.status(404).json("No se encontró el producto")))}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})})).delete((async(e,r)=>{if(c){let o;o=e.body.id?Number(e.body.id):Number(e.params.id),i.p.deleteById(o).then((e=>e?r.status(202).json("Producto eliminado"):r.status(404).json({error:"El producto no existe"})))}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})}));const l=(0,s.Router)();l.use(n().json()),l.route("/api/carrito/:id?").post((async(e,r)=>{if(e.params.id)r.status(400).json({error:"No se puede crear un carrito con ID manual"});else{const e=await i.F.create();r.status(200).json(e)}})).delete((async(e,r)=>{let o;o=e.body.id?Number(e.body.id):Number(e.params.id),i.F.deleteCartById(o).then((e=>e?r.status(202).json("Carrito eliminado"):r.status(404).json("No se encontró el carrito")))})),l.route("/api/carrito/:id?/productos").get((async(e,r)=>{let o;if(o=e.body.id?Number(e.body.id):Number(e.params.id),o){const e=await i.F.getAllProdById(o);e?r.status(200).json(e):r.status(404).json({error:"No se encontró el carrito solicitado"})}else r.status(404).json({error:"Es necesario un ID para buscar el carrito"})})).post((async(e,r)=>{let o;o=e.body.id?Number(e.body.id):Number(e.params.id);let t=Number(e.body.id_prod);const s=await i.p.getById(t);i.F.addProduct(o,s),r.status(202).json("El producto fue agregado al carrito.")})),l.delete("/api/carrito/:id?/productos/:id_prod",(async(e,r)=>{let o,t;e.body.id?(o=Number(e.body.id),t=Number(e.body.id_prod)):(o=Number(e.params.id),t=Number(e.params.id_prod)),await i.F.deleteProdById(o,t)?r.status(202).json("El producto fue eliminado"):r.status(400).json("No se encontró el producto a eliminar")})),t()}catch(e){t(e)}}))},584:(e,r,o)=>{o.d(r,{W:()=>u});var t=o(860),s=o(831);const a=require("normalizr"),n=new a.schema.Entity("authors"),i=new a.schema.Entity("messages",{author:n},{idAttribute:"id"}),u=(0,t.Router)();u.route("/chat").get((async(e,r)=>{const o=await(0,s.U)(),t=(n=o,(0,a.normalize)(n,[i]));var n;0!=o.length?r.status(200).json({messages:o,normMessages:t}):r.status(404).json({error:"No messages"})})).post((async(e,r)=>{const o=e.body;(0,s.a)(o),r.status(202).json({OK:"Mensaje subido"})}))},11:(e,r,o)=>{o.d(r,{x:()=>t});const t=(0,o(860).Router)();t.route("/login").post(((e,r)=>{let o=e.body.user;e.session.user=o,console.log(e.session),e.session.user?r.status(200).json({user:e.session.user}):r.status(400).json({error:"Error logging"})})),t.route("/user").get((async(e,r)=>{console.log(e.session),e.session.user?r.status(200).json(e.session.user):r.status(404).json({error:"Error getting username"})})),t.route("/logout").get((async(e,r)=>{e.session.destroy((e=>{e?r.status(400):r.status(200)}))}))},943:(e,r,o)=>{o.d(r,{Z:()=>i});var t=o(860);const s=require("@faker-js/faker");o(81);const a=Number(process.env.qty),n=(0,t.Router)();n.route("/productos-test").get((async(e,r)=>{const o=await(async()=>{let e=[];for(let r=0;r<a;r++){const r={name:s.faker.commerce.productName(),price:Number(s.faker.commerce.price()),image:s.faker.image.imageUrl()};e.push(r)}return e})();o.length>0?r.status(200).json(o):r.status(404).send({message:"Products Not Found"})}));const i=n},728:(e,r,o)=>{o.a(e,(async(e,r)=>{try{var t=o(860),s=o.n(t),a=o(986),n=o.n(a),i=o(710),u=o.n(i),c=o(508),d=o.n(c),l=o(730),m=o.n(l),p=o(582),y=o.n(p),b=o(695),g=o(943),h=o(584),f=o(11),j=o(831),w=o(685),v=o.n(w),N=o(952),x=e([b]);b=(x.then?(await x)():x)[0];const _=s()();_.use(y()()),_.use(s().urlencoded({extended:!0})),_.use(d()({store:m().create({mongoUrl:"mongodb+srv://julian:yYh1YRWZiJ0EcbHi@cluster0.ovaqa.mongodb.net/myFirstDatabase?retryWrites=true"}),secret:"shhhhhh",resave:!1,saveUninitialized:!1,cookie:{maxAge:2e4}})),_.use(b.W),_.use(b.t),_.use(g.Z),_.use(h.W),_.use(f.x),_.use(u()()),_.use(n().json());const q=v().createServer(_);new N.Server(q,{cors:{origin:"http://localhost:3000",methods:["GET","POST"]}}).on("connection",(e=>{console.log(`User Connected: ${e.id}`),e.on("disconnect",(()=>{console.log("user disconnected",e.id)})),e.on("join_room",(r=>{e.join(r),console.log(`user with ID: ${e.id} connect to room: ${r}`)})),e.on("send_message",(r=>{(0,j.a)(r),e.to("testRoom").emit("receive_message",r)}))}));const S=process.env.PORT||8080;q.listen(S,(()=>{console.log(`Contectando al puerto: ${S}`)})),r()}catch(e){r(e)}}))},986:e=>{e.exports=require("body-parser")},730:e=>{e.exports=require("connect-mongo")},710:e=>{e.exports=require("cookie-parser")},582:e=>{e.exports=require("cors")},81:e=>{e.exports=require("dotenv/config")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},185:e=>{e.exports=require("mongoose")},952:e=>{e.exports=require("socket.io")},685:e=>{e.exports=require("http")}},u={};function c(e){var r=u[e];if(void 0!==r)return r.exports;var o=u[e]={exports:{}};return i[e](o,o.exports,c),o.exports}c.m=i,e="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",r="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",t=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s=e=>!--e.r&&e(),a=(e,r)=>e?e.push(r):s(r),c.a=(n,i,u)=>{var c,d,l,m=u&&[],p=n.exports,y=!0,b=!1,g=(r,o,t)=>{b||(b=!0,o.r+=r.length,r.map(((r,s)=>r[e](o,t))),b=!1)},h=new Promise(((e,r)=>{l=r,d=()=>(e(p),t(m),m=0)}));h[r]=p,h[e]=(e,r)=>{if(y)return s(e);c&&g(c,e,r),a(m,e),h.catch(r)},n.exports=h,i((n=>{var i;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var i=[];n.then((e=>{u[r]=e,t(i),i=0}),(e=>{u[o]=e,t(i),i=0}));var u={};return u[e]=(e,r)=>(a(i,e),n.catch(r)),u}}var c={};return c[e]=e=>s(e),c[r]=n,c})))(n);var u=()=>c.map((e=>{if(e[o])throw e[o];return e[r]})),d=new Promise(((e,r)=>{(i=()=>e(u)).r=0,g(c,i,r)}));return i.r?d:u()}),(e=>(e&&l(h[o]=e),d()))),y=!1},c.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return c.d(r,{a:r}),r},c.d=(e,r)=>{for(var o in r)c.o(r,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce(((r,o)=>(c.f[o](e,r),r)),[])),c.u=e=>e+".main.js",c.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n={179:1},c.f.require=(e,r)=>{n[e]||(e=>{var r=e.modules,o=e.ids,t=e.runtime;for(var s in r)c.o(r,s)&&(c.m[s]=r[s]);t&&t(c);for(var a=0;a<o.length;a++)n[o[a]]=1})(require("./"+c.u(e)))},c(728)})();