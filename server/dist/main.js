(()=>{"use strict";var e,r,t,o,s,n,a,i={831:(e,r,t)=>{t.d(r,{U:()=>u,a:()=>i});var o=t(913),s=t(185);(async()=>{await(0,s.connect)(o.Z.mongodb.path)})().catch((e=>{throw console.log(e),new Error("error con mongoose")}));const n=new s.Schema({author:{id:{type:String,required:!0},firstName:{type:String,required:!0,max:50},lastName:{type:String,required:!0,max:50},age:{type:Number,required:!0},alias:{type:String,required:!0,max:20},avatar:{type:String,required:!0}},text:{type:String,required:!0,max:500}}),a=(0,s.model)("messages",n),i=async e=>{const r=new a(e);try{r.save()}catch(e){throw console.log(e),new Error("Error")}},u=async()=>{try{return await a.find()}catch(e){throw console.log(e),new Error("Error")}}},983:(e,r,t)=>{t.a(e,(async(e,o)=>{try{let e,s,n;t.d(r,{Ff:()=>s,pf:()=>e}),t(81);const{default:a}=await t.e(516).then(t.bind(t,516)),{default:i}=await t.e(917).then(t.bind(t,917)),{default:u}=await t.e(114).then(t.bind(t,114));s=new a,e=new i,n=new u,o()}catch(e){o(e)}}),1)},913:(e,r,t)=>{t.d(r,{Z:()=>o});const o={fileSystem:{path:"./controllers"},mongodb:{path:"mongodb+srv://julian:yYh1YRWZiJ0EcbHi@cluster0.ovaqa.mongodb.net/myFirstDatabase?retryWrites=true"}}},695:(e,r,t)=>{t.a(e,(async(e,o)=>{try{t.d(r,{W:()=>d,t:()=>l});var s=t(860),n=t(986),a=t.n(n),i=t(983),u=e([i]);i=(u.then?(await u)():u)[0];const c=!0,d=(0,s.Router)();d.use(a().json()),d.route("/api/productos/:id?").get((async(e,r,t)=>{let o;if(o=e.body.id?Number(e.body.id):Number(e.params.id),o){const e=await i.pf.getById(o);e?r.status(200).json(e):r.status(404).json({error:" Error with ID "})}else{const e=await i.pf.getAll();e?r.status(200).json(e):r.status(404)}})).post((async(e,r)=>{if(c)if(e.params.id)r.status(400).json({error:" No se puede crear un producto con un id"});else{const t=e.body,o=i.pf.save(t);r.status(200).json(`El producto ${e.body.nombre} con el id ${o} se generó correctamente`)}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})})).put((async(e,r)=>{if(c){const t=e.body;let o;o=e.body.id?Number(e.body.id):Number(e.params.id),i.pf.modifyById(t,o).then((e=>e?r.status(202).json("Producto modificado"):r.status(404).json("No se encontró el producto")))}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})})).delete((async(e,r)=>{if(c){let t;t=e.body.id?Number(e.body.id):Number(e.params.id),i.pf.deleteById(t).then((e=>e?r.status(202).json("Producto eliminado"):r.status(404).json({error:"El producto no existe"})))}else r.status(401).json({error:-1,descripcion:"Permisos denegados"})}));const l=(0,s.Router)();l.use(a().json()),l.route("/api/carrito/:id?").post((async(e,r)=>{if(e.params.id)r.status(400).json({error:"No se puede crear un carrito con ID manual"});else{const e=await i.Ff.create();r.status(200).json(e)}})).delete((async(e,r)=>{let t;t=e.body.id?Number(e.body.id):Number(e.params.id),i.Ff.deleteCartById(t).then((e=>e?r.status(202).json("Carrito eliminado"):r.status(404).json("No se encontró el carrito")))})),l.route("/api/carrito/:id?/productos").get((async(e,r)=>{let t;if(t=e.body.id?Number(e.body.id):Number(e.params.id),t){const e=await i.Ff.getAllProdById(t);e?r.status(200).json(e):r.status(404).json({error:"No se encontró el carrito solicitado"})}else r.status(404).json({error:"Es necesario un ID para buscar el carrito"})})).post((async(e,r)=>{let t;t=e.body.id?Number(e.body.id):Number(e.params.id);let o=Number(e.body.id_prod);const s=await i.pf.getById(o);i.Ff.addProduct(t,s),r.status(202).json("El producto fue agregado al carrito.")})),l.delete("/api/carrito/:id?/productos/:id_prod",(async(e,r)=>{let t,o;e.body.id?(t=Number(e.body.id),o=Number(e.body.id_prod)):(t=Number(e.params.id),o=Number(e.params.id_prod)),await i.Ff.deleteProdById(t,o)?r.status(202).json("El producto fue eliminado"):r.status(400).json("No se encontró el producto a eliminar")})),o()}catch(e){o(e)}}))},584:(e,r,t)=>{t.d(r,{W:()=>u});var o=t(860),s=t(831);const n=require("normalizr"),a=new n.schema.Entity("authors"),i=new n.schema.Entity("messages",{author:a},{idAttribute:"id"}),u=(0,o.Router)();u.route("/chat").get((async(e,r)=>{const t=await(0,s.U)(),o=(a=t,(0,n.normalize)(a,[i]));var a;0!=t.length?r.status(200).json({messages:t,normMessages:o}):r.status(404).json({error:"No messages"})})).post((async(e,r)=>{const t=e.body;(0,s.a)(t),r.status(202).json({OK:"Mensaje subido"})}))},179:(e,r,t)=>{t.d(r,{x:()=>f});var o=t(860),s=t(511),n=t.n(s),a=t(55),i=t.n(a),u=t(185),c=t.n(u),d=t(96),l=t.n(d),p=t(913);const m=new(c().Schema)({user:{type:String,unique:!0},password:{type:String},isAdmin:{type:Boolean,default:!1}}),y=c().model("user",m),b=i().Strategy;(async()=>{await c().connect(p.Z.mongodb.path)})().catch((e=>{throw console.log(e),new Error("error con mongoose")})),n().use(new b(((e,r,t)=>{y.findOne({user:e},((e,o)=>{if(e)throw e;if(!o)return t(null,!1);l().compare(r,o.password,((e,r)=>{if(e)throw e;return t(null,!0===r&&o)}))}))}))),n().serializeUser(((e,r)=>{r(null,e.id)})),n().deserializeUser(((e,r)=>{y.findOne({_id:e},((e,t)=>{const o={user:t.user,isAdmin:t.isAdmin};r(e,o)}))}));const f=(0,o.Router)();f.post("/register",(async(e,r)=>{try{const{user:t,password:o}=e.body;if(!t||!o||"string"!=typeof t||"string"!=typeof o)return r.status(400).json({error:"invalid user"});y.findOne({user:t},(async(e,s)=>{if(e)throw e;if(s)return r.status(400).json({error:"user exist"});if(!s){const e=await l().hash(o,Number(process.env.saltBcrypt)),s=new y({user:t,password:e});return await s.save(),r.status(200).json({ok:"ok"})}}))}catch(e){throw console.log(e),new Error("error register")}})),f.post("/login",n().authenticate("local"),((e,r)=>{r.send("success")})),f.get("/user",((e,r)=>{r.status(200).json({user:e.user})}))},943:(e,r,t)=>{t.d(r,{Z:()=>i});var o=t(860);const s=require("@faker-js/faker");t(81);const n=Number(process.env.qty),a=(0,o.Router)();a.route("/productos-test").get((async(e,r)=>{const t=await(async()=>{let e=[];for(let r=0;r<n;r++){const r={name:s.faker.commerce.productName(),price:Number(s.faker.commerce.price()),image:s.faker.image.imageUrl()};e.push(r)}return e})();t.length>0?r.status(200).json(t):r.status(404).send({message:"Products Not Found"})}));const i=a},728:(e,r,t)=>{t.a(e,(async(e,r)=>{try{var o=t(860),s=t.n(o),n=t(986),a=t.n(n),i=t(710),u=t.n(i),c=t(508),d=t.n(c),l=t(511),p=t.n(l),m=t(55),y=t.n(m),b=t(685),f=t.n(b),g=t(952),h=t(582),w=t.n(h),j=t(695),v=t(943),x=t(584),N=t(179),S=t(831),_=e([j]);j=(_.then?(await _)():_)[0];const q=s()();q.use(d()({secret:"shhhhhh",resave:!0,saveUninitialized:!0})),q.use(w()({origin:"http://localhost:3000",credentials:!0})),q.use(a().urlencoded({extended:!0})),q.use(u()()),q.use(a().json()),q.use(p().initialize()),q.use(p().session()),y().Strategy,q.use(j.W),q.use(j.t),q.use(v.Z),q.use(x.W),q.use(N.x);const E=f().createServer(q);new g.Server(E,{cors:{origin:"http://localhost:3000",methods:["GET","POST"]}}).on("connection",(e=>{console.log(`User Connected: ${e.id}`),e.on("disconnect",(()=>{console.log("user disconnected",e.id)})),e.on("join_room",(r=>{e.join(r),console.log(`user with ID: ${e.id} connect to room: ${r}`)})),e.on("send_message",(r=>{(0,S.a)(r),e.to("testRoom").emit("receive_message",r)}))}));const P=process.env.PORT||8080;E.listen(P,(()=>{console.log(`Contectando al puerto: ${P}`)})),r()}catch(e){r(e)}}))},96:e=>{e.exports=require("bcrypt")},986:e=>{e.exports=require("body-parser")},710:e=>{e.exports=require("cookie-parser")},582:e=>{e.exports=require("cors")},81:e=>{e.exports=require("dotenv/config")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},185:e=>{e.exports=require("mongoose")},511:e=>{e.exports=require("passport")},55:e=>{e.exports=require("passport-local")},952:e=>{e.exports=require("socket.io")},685:e=>{e.exports=require("http")}},u={};function c(e){var r=u[e];if(void 0!==r)return r.exports;var t=u[e]={exports:{}};return i[e](t,t.exports,c),t.exports}c.m=i,e="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",r="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",t="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s=e=>!--e.r&&e(),n=(e,r)=>e?e.push(r):s(r),c.a=(a,i,u)=>{var c,d,l,p=u&&[],m=a.exports,y=!0,b=!1,f=(r,t,o)=>{b||(b=!0,t.r+=r.length,r.map(((r,s)=>r[e](t,o))),b=!1)},g=new Promise(((e,r)=>{l=r,d=()=>(e(m),o(p),p=0)}));g[r]=m,g[e]=(e,r)=>{if(y)return s(e);c&&f(c,e,r),n(p,e),g.catch(r)},a.exports=g,i((a=>{var i;c=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var i=[];a.then((e=>{u[r]=e,o(i),i=0}),(e=>{u[t]=e,o(i),i=0}));var u={};return u[e]=(e,r)=>(n(i,e),a.catch(r)),u}}var c={};return c[e]=e=>s(e),c[r]=a,c})))(a);var u=()=>c.map((e=>{if(e[t])throw e[t];return e[r]})),d=new Promise(((e,r)=>{(i=()=>e(u)).r=0,f(c,i,r)}));return i.r?d:u()}),(e=>(e&&l(g[t]=e),d()))),y=!1},c.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return c.d(r,{a:r}),r},c.d=(e,r)=>{for(var t in r)c.o(r,t)&&!c.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce(((r,t)=>(c.f[t](e,r),r)),[])),c.u=e=>e+".main.js",c.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a={179:1},c.f.require=(e,r)=>{a[e]||(e=>{var r=e.modules,t=e.ids,o=e.runtime;for(var s in r)c.o(r,s)&&(c.m[s]=r[s]);o&&o(c);for(var n=0;n<t.length;n++)a[t[n]]=1})(require("./"+c.u(e)))},c(728)})();